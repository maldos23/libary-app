# ─── DataSource ───────────────────────────────────────────────────────────────
quarkus.datasource.db-kind=mysql
# Prod: Cloud SQL socket connector vía Unix socket montado por --add-cloudsql-instances.
#       NO usar ipTypes=PUBLIC: ese modo fuerza TCP y omite el socket de Cloud Run.
#       CLOUD_SQL_INSTANCE = PROJECT:REGION:INSTANCE  (ej. labs-488820:us-central1:library-db)
%prod.quarkus.datasource.jdbc.url=jdbc:mysql:///${DB_NAME}?socketFactory=com.google.cloud.sql.mysql.SocketFactory&cloudSqlInstance=${CLOUD_SQL_INSTANCE}
# Dev: MySQL local
%dev.quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3306/${DB_NAME:library}
quarkus.datasource.username=${DB_USER:root}
quarkus.datasource.password=${DB_PASS:}

# ─── DataSource pool ────────────────────────────────────────────────────────────
quarkus.datasource.jdbc.initial-size=0
quarkus.datasource.jdbc.min-size=0
quarkus.datasource.jdbc.acquisition-timeout=30

# ─── Hibernate ORM ────────────────────────────────────────────────────────────
# Dev: crea/actualiza las tablas automáticamente
%dev.quarkus.hibernate-orm.database.generation=update
# Prod: 'none' evita que Hibernate intente conectarse al arrancar para comparar el esquema.
#       Las tablas se crean en el primer deploy con 'update'; cambiar a 'none' después.
#       Para re-crear el esquema puntualmente usa el secret QUARKUS_HIBERNATE_ORM_DATABASE_GENERATION=update
%prod.quarkus.hibernate-orm.database.generation=${QUARKUS_HIBERNATE_ORM_DATABASE_GENERATION:none}
quarkus.hibernate-orm.log.sql=false

# ─── HTTP / CORS ──────────────────────────────────────────────────────────────
# Cloud Run inyecta $PORT automáticamente; el fallback es 8080
quarkus.http.port=${PORT:8080}
quarkus.http.host=0.0.0.0
# CORS abierto: permite cualquier origen (sin restricciones por ahora)
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,Accept

# ─── OpenAPI ──────────────────────────────────────────────────────────────────
# Swagger UI solo en desarrollo; se deshabilita en prod para no exponer la superficie de ataque
%dev.quarkus.swagger-ui.always-include=true
%prod.quarkus.swagger-ui.always-include=false
quarkus.smallrye-openapi.info-title=Library API
quarkus.smallrye-openapi.info-version=1.0.0
quarkus.smallrye-openapi.info-description=API REST del Sistema de Gestión de Biblioteca

# ─── Límites de seguridad HTTP ────────────────────────────────────────────────
# Limitar el tamaño del cuerpo de la petición para prevenir ataques de payload masivo
quarkus.http.limits.max-body-size=100K
# Cerrar conexiones inactivas rápidamente
quarkus.http.idle-timeout=30S

# ─── Access Log (auditoría) ────────────────────────────────────────────────────
quarkus.http.access-log.enabled=true
quarkus.http.access-log.pattern=%h %l %u %t "%r" %s %b
# Nota: la cabecera Server se elimina en SecurityHeadersFilter (ContainerResponseFilter)